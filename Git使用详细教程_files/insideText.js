;(function(oojs) {oojs.define({name:"insideText",namespace:"dup.ui.painter",deps:{config:"dup.common.config",lang:"dup.common.utility.lang",dom:"dup.common.utility.dom",slot:"dup.business.slot",param:"dup.business.param",data:"dup.common.utility.data",viewWatch:"dup.business.viewWatch",browser:"dup.common.utility.browser",richMaterial:"dup.ui.painter.richMaterial",event:"dup.common.utility.event",monitor:"dup.business.monitor"},validate:function(e){return!0},hashBox:{},itemIndex:0,maxBytes:null,SET_DATA_JSONP:"BAIDU_NEW_DUP_INSIDE",baiduTip:null,render:function(e){if(this.slot.setStatus(e.id,this.config.STATUS_RENDERED),this.validate(e)){this.monitor.sendLog(e);var t=this.dom.g(e.containerId);if(t.style.display="none",t){var i=this.resBody(t);if(i){if(e.isOnceSeach){var s=e.response.bes_ads;if(this.resChild(i),!s)return;this.textNodeCompare(s)}else this.data.defineOnce(this.SET_DATA_JSONP,oojs.proxy(this,this.textNodeCompare));var n=this;document.onreadystatechange=function(){if("complete"===document.readyState)if(e.isOnceSeach){var s=e.response.bes_ads;if(n.resChild(i),!s)return;n.textNodeCompare(s)}else n.getScriptHTML(e,t),n.resChild(i)},this.event.bind(i,"mousedown",oojs.proxy(this,this.removeHuaci)),this.event.bind(i,"mouseup",oojs.proxy(this,this.huaci)),this.viewWatch.regisetViewWatch(e),this.slot.setStatus(e.id,this.config.STATUS_FINISH)}}}},resBody:function(e){var t=e.parentNode;return t.tagName&&"body"===t.tagName.toLowerCase()?t:this.resBody(t)},getScriptHTML:function(e,t){var i=i||"scriptId"+e.id;e.scriptId=i,e.paramObj.dcb=this.SET_DATA_JSONP,e.paramObj.cec="utf-8";var s=this.param.getPmpRequestUrl(e,this.config.STATIC_JSONP),n=document.createElement("script");n.id=e.scriptId,n.src=s,n.charset=e.paramObj.cec,t.appendChild(n)},resChild:function(e){for(var t=e.childNodes,i=0;i<t.length;i++)if(this.delScript(t[i])){if("br"===t[i].nodeName.toLocaleLowerCase())break;switch(t[i].nodeType){case 3:var s;this.browser.ie<9&&t[i].nodeValue&&(s=t[i].nodeValue),t[i].textContent&&(s=t[i].textContent),"undefined"!=typeof s&&null!==s&&s.length>200&&this.addHash(t[i]);break;case 1:default:this.resChild(t[i])}}},delScript:function(e){return"a"!==e.nodeName.toLowerCase()&&"script"!==e.nodeName.toLowerCase()&&"iframe"!==e.nodeName.toLowerCase()&&"br"!==e.nodeName.toLowerCase()},addHash:function(e){var t=this.getTag(e);if(t.innerHTML){var i=this.lang.trim(t.innerHTML),s=[t,i];this.hashBox["item_"+this.itemIndex]=s,this.itemIndex++}},textNodeCompare:function(){if(!arguments[0]||null!==typeof arguments[0]){var e=arguments[0].slots[0].ads[0]||!1;if(e){var t=e.data.meta;this.is_instan=+arguments[0].slots[0].conf.ext.instan,this.iss=+arguments[0].slots[0].conf.ext.iss,this.is_instan&&(this.getFirstUrl=t[0].curl,this.is_iss&&(this.iss=1));var i=300;for(var s in this.hashBox){for(var n=[],o=this.hashBox[s][1],r=o.split(""),a=Math.ceil(r.length/i),d=0;a>d;d++){var c=r.splice(0,i).join("");this.isSrcool=!1;for(var l=0;l<t.length;l++)this.isSrcool||(c=this.strReplace(t[l],c));n.push(c)}this.hashBox[s][0].innerHTML=n.join("")}}}},strReplace:function(e,t){if(e||t&&"string"==typeof t){var i,s=e.title,n=new RegExp(s,"i");this.iss?e.curl=e.curl.replace(/&di=\d*/,"&di=128"):e.curl=e.curl.replace(/&di=\d*/,"&di=8");var o='<a href="'+e.curl+'" target="_blank" style="color:#38f;text-decoration:none">'+s+"</a>";return n.test(t)&&s.length?(this.isSrcool=!0,i=t.replace(n,o)):t}},getTag:function(e){return null!==e?e.parentNode:void 0},checkData:function(e){for(var t=[],i={},s=e.length,n=0;s>n;n++)i["item_"+n]=e[n].title;for(var o in i)if(i.hasOwnProperty(o))for(var r=0;s>r;r++){new RegExp(e.title,"i")}return t},byteLen:function(e){for(var t=0,i=0;i<e.length;i++)e.charCodeAt(i)>127||94===e.charCodeAt(i)?t+=2:t++;return t},checkStr:function(e){var e=e[1];if("string"==typeof e){var t,i=this.byteLen(e);return t=i>1e3?Math.ceil(i/1e3):2}},huaci:function(e){if(this.getFirstUrl){var t=e||window.event,i=t.target||t.srcElement;if("input"!==i.tagName.toLowerCase()&&i.id!==this.baiduTip){var s="";document.selection?s=document.selection.createRange().text:window.getSelection()&&(s=window.getSelection().toString()),s.length&&""!==s&&s!==this.PreSelection&&this.drawIcon(s,t)}}},drawIcon:function(e,t){var i=document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop,s=5,n=10,o=this.browser.ie<9?t.clientX:t.pageX,r=38,a=this.browser.ie<9?t.clientY+i-document.body.clientTop:t.pageY;this.baiduTip=""+this.SET_DATA_JSONP+Math.ceil(1e5*Math.random());var d=document.createElement("img");d.id=this.baiduTip,d.src="//cpro.baidustatic.com/cpro/ui/noexpire/img/2.0.0/icon.png",d.style.cursor="pointer",d.style.width=r+"px",d.style.height=r+"px",d.style.position="absolute",d.style.top=parseInt(a,10)-r-s+"px",d.style.left=o+s+"px",e.length>n&&(e=e.substr(0,n)),d.alt=e,document.body.appendChild(d),this.event.bind(d,"click",oojs.proxy(this,this.openUrl))},removeHuaci:function(e){if(this.getFirstUrl){var t=e||window.event,i=t.target||t.srcElement,s=document.getElementById(this.baiduTip);null!==s&&i.id!==this.baiduTip&&document.body.removeChild(s)}},openUrl:function(e){var t,i=e||window.event,s=i.target||i.srcElement,n=document.getElementById(this.baiduTip),o=encodeURIComponent(s.alt);n&&(t=this.iss?this.getFirstUrl.replace(/&k=[^&]*/g,"&k="+o).replace(/&di=\d*/g,"&di=128"):this.getFirstUrl.replace(/&k=[^&]*/g,"&k="+o).replace(/&di=\d*/g,"&di=8"),window.open(t),document.body.removeChild(n))}});})(_ssp_global.oojs);